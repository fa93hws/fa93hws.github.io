(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{435:function(e,t,n){"use strict";var o=n(406),a=n.n(o),r=n(35),s=n(418),c=function(e,t,n,o){var a,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},i=new(function(){function e(){this.clientId="Iv1.982f55cf525f853f",this.axiosInstance=a.a.create(),this.lsKey="access_token"}return e.prototype.auth=function(e){var t=["https://github.com/login/oauth/authorize"];t.push("?client_id="+this.clientId),t.push("&redirect_uri="+e),window.location.replace(t.join(""))},e.prototype.getToken=function(e){var t=this;return new Promise(function(n,o){var a="https://jjaoiq1l2h.execute-api.ap-southeast-2.amazonaws.com/production/?code="+e;t.axiosInstance.get(a).then(function(e){void 0!==e.data.access_token?(localStorage.setItem("access_token",e.data.access_token),n(e.data.access_token)):o("access_token not appear")}).catch(o)})},e.prototype.saveToken=function(e){localStorage.setItem(this.lsKey,e)},e.prototype.loadToken=function(){var e=localStorage.getItem(this.lsKey);return null===e?"":e},e.prototype.removeToken=function(){localStorage.removeItem(this.lsKey)},e.prototype.getUser=function(e){var t=this;return new Promise(function(n,o){t.axiosInstance.get("https://api.github.com/user?access_token="+e).then(function(e){n(new s.a(e.data))}).catch(o)})},c([r.a],e.prototype,"auth",null),c([r.a],e.prototype,"getToken",null),c([r.a],e.prototype,"saveToken",null),c([r.a],e.prototype,"loadToken",null),c([r.a],e.prototype,"removeToken",null),c([r.a],e.prototype,"getUser",null),e}());t.a=i},516:function(e,t,n){e.exports={button:"button--18m6H","button-primary":"button-primary--1jyYj",buttonPrimary:"button-primary--1jyYj",container:"container--3Lcpw",visitor:"visitor--1m-KR",editor:"editor--uQwyv","login-mask":"login-mask--3CbaP",loginMask:"login-mask--3CbaP",header:"header--KvH_W",field:"field--212PS","field-name":"field-name--2ld4y",fieldName:"field-name--2ld4y","editor-wrapper":"editor-wrapper--1gz1y",editorWrapper:"editor-wrapper--1gz1y",login:"login--1uFZV",actions:"actions--21EcI",submit:"submit--3RAfx",pending:"pending--2cqzG"}},517:function(e,t,n){e.exports={container:"container--2JG7i",list:"list--oKH1Q","no-comment":"no-comment--1UTTU",noComment:"no-comment--1UTTU",item:"item--2tDzY",header:"header--3Hk6D","header-left":"header-left--2ssXV",headerLeft:"header-left--2ssXV",avatar:"avatar--2dvyY","header-right":"header-right--152Dx",headerRight:"header-right--152Dx",name:"name--1hVIg","is-author":"is-author--9rnaF",isAuthor:"is-author--9rnaF",time:"time--E3I9K",reply:"reply--37qPC",row:"row--8IJiF","row-1":"row-1--35H1d",row1:"row-1--35H1d",body:"body--2N56q"}},518:function(e,t,n){"use strict";n.r(t);var o,a=n(1),r=n.n(a),s=n(66),c=n(444),i=n(435),u=n(418),l=n(516),m=n.n(l);!function(e){e[e.notSubmitted=0]="notSubmitted",e[e.pending=1]="pending",e[e.success=2]="success",e[e.failed=3]="failed"}(o||(o={}));var f=n(83),h=n(406),p=n.n(h),d=n(35),b=function(e,t,n,o){var a,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},g=new(function(){function e(){this.axiosInstance=p.a.create({baseURL:"https://api.github.com/repos/fa93hws/fa93hws.github.io/issues/"})}return e.prototype.postComment=function(e,t,n){return this.axiosInstance.post(e+"/comments?access_token="+n,{body:t})},b([d.a],e.prototype,"postComment",null),e}()),y=new f.a;function v(){var e=Object(a.useContext)(c.BlogContext),t=Object(a.useMemo)(function(){return window.location.origin+"/auth?blog_number="+e.number},[e]);return r.a.createElement("div",{className:m.a.loginMask},r.a.createElement("a",{onClick:function(){return i.a.auth(t)},className:m.a.login},"Login"))}function w(){var e=Object(a.useRef)(null),t=y.useState("content"),n=t[0],o=t[1],s=Object(a.useState)(0),c=s[0],i=s[1];return Object(a.useEffect)(function(){null!==e.current&&e.current.scrollHeight!==e.current.clientHeight&&i(e.current.scrollHeight)},[n]),r.a.createElement("textarea",{ref:e,value:n,onChange:function(e){o(e.target.value)},style:{height:c},className:m.a.editor,placeholder:"吐槽作者"})}y.createState("content","");var C=function(e){var t=e.user;e.handleSubmit;return r.a.createElement("div",{className:m.a.editor},r.a.createElement("header",{className:m.a.header},r.a.createElement("p",{className:m.a.field},r.a.createElement("span",{className:m.a.fieldName},"Github 帐号名:"),r.a.createElement("span",null,t.login)),r.a.createElement("p",{className:m.a.field},r.a.createElement("span",{className:m.a.fieldName},"Github 用户名:"),r.a.createElement("span",null,t.displayName))),r.a.createElement("section",{className:m.a.editorWrapper},r.a.createElement(w,null)))};var j=function(){var e=Object(a.useState)(o.notSubmitted),t=e[0],n=e[1],l=Object(a.useState)(new u.a),f=l[0],h=l[1],p=Object(a.useMemo)(function(){switch(t){case o.pending:return r.a.createElement(s.a,null);case o.notSubmitted:case o.success:return r.a.createElement(C,{user:f,handleSubmit:T});case o.failed:return r.a.createElement("div",null,"载入用户信息失败")}},[t,f]),d=Object(a.useState)(""),b=d[0],w=d[1];Object(a.useEffect)(function(){w(i.a.loadToken())},[]);var j=Object(a.useMemo)(function(){return""!==b},[b]),E=Object(a.useMemo)(function(){var e=m.a.container;return j||(e+=" "+m.a.visitor),e},[j]);Object(a.useEffect)(function(){""!==b&&(n(o.pending),i.a.getUser(b).then(function(e){h(e),n(o.success)}).catch(function(e){console.error(e),n(o.failed)}))},[j]);var O=y.useState("content")[0],k=Object(a.useState)(o.notSubmitted),_=k[0],N=k[1],S=Object(a.useMemo)(function(){return _===o.pending?m.a.submit+" "+m.a.pending:m.a.submit},[_]),R=Object(a.useContext)(c.BlogContext);function T(){""!==O&&_!==o.pending&&(N(o.pending),g.postComment(R.number,O,b).then(function(e){N(o.success),console.log(e)}).catch(function(e){N(o.failed),console.error(e),alert("提交失败")}))}return r.a.createElement("div",{className:E},r.a.createElement(v,null),p,r.a.createElement("div",{className:m.a.actions},r.a.createElement("a",{onClick:T,className:S},"提交")))},E=n(426),O=n(421),k=n(422);function _(e){var t=["content",{name:"users",children:["totalCount"]}];return!0===e&&t.push("viewerHasReacted"),{name:"reactionGroups",children:t}}function N(e,t){return void 0===t&&(t=!1),{name:"comments",search:e,children:["totalCount",{name:"nodes",children:["publishedAt","id","body",{name:"bodyHTML",alias:"content"},Object(k.a)(["name","avatarUrl","url","id"]),_(t)]}]}}var S,R=n(416),T=function(){return function(e){var t=this;this.up=0,this.down=0,this.love=0,this.eyes=0,this.laugh=0,this.hooray=0,this.rocket=0,this.confused=0,e.forEach(function(e){switch(e.content){case"THUMBS_UP":t.up=e.users.totalCount;break;case"THUMBS_DOWN":t.down=e.users.totalCount;break;case"HEART":t.love=e.users.totalCount;break;case"LAUGH":t.laugh=e.users.totalCount;break;case"HOORAY":t.hooray=e.users.totalCount;break;case"CONFUSED":t.confused=e.users.totalCount;break;case"ROCKET":t.rocket=e.users.totalCount;break;case"EYES":t.eyes=e.users.totalCount;break;default:throw new Error("unknown reaction type "+e.content)}})}}(),P=(S=function(e,t){return(S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}S(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),x=function(e,t,n,o){var a,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},U=function(e){function t(t){var n=e.call(this,t)||this;return n.author=new u.a(t.author),n.reactions=new T(t.reactionGroups),n}return P(t,e),Object.defineProperty(t.prototype,"timeStr",{get:function(){var e=new Date(this.publishedAt),t=(new Date).getTime()-e.getTime();return t<6e4?Math.floor(t/1e3)+" 秒前":t<36e5?Math.floor(t/60/1e3)+" 分钟前":t<864e5?Math.floor(t/3600/1e3)+" 小时前":(void 0===this._timeStr&&void 0!==this.publishedAt&&""!==this.publishedAt&&(this._timeStr=this.publishedAt.split("T")[0].replace("-","年").replace("-","月")+"日"),this._timeStr)},enumerable:!0,configurable:!0}),t.prototype.parseGQResponse=function(e){this.id=e.id,this.publishedAt=e.publishedAt,this.content=e.content,this.author=new u.a(e.author),this.reactions=new T(e.reactionGroups)},x([d.a],t.prototype,"parseGQResponse",null),t}(R.a),I=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),H=function(e,t,n,o){var a,r=arguments.length,s=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(s=(r<3?a(s):r>3?a(t,n,s):a(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.totalCount=0,t.contents=[],t}return I(t,e),t.prototype.parseGQResponse=function(e){var t=this;this.totalCount=e.totalCount,e.nodes.forEach(function(e){return t.contents.push(new U(e))})},H([d.a],t.prototype,"parseGQResponse",null),t}(R.a),A=function(){function e(e,t){this.totalCount=0,this.freshComments=[],this.oldComments=[],this.totalCount=e.totalCount,this.freshComments=e.contents,this.oldComments=t.contents,this.organizeComments()}return Object.defineProperty(e.prototype,"hasUnloaded",{get:function(){return 0!==this.numUnloaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numUnloaded",{get:function(){var e=this.totalCount-this.freshComments.length-this.oldComments.length;return Math.max(0,e)},enumerable:!0,configurable:!0}),e.prototype.organizeComments=function(){if(!this.hasUnloaded){if(this.totalCount!==this.freshComments.length){var e=this.freshComments[this.freshComments.length-1],t=this.oldComments.findIndex(function(t){return t.id===e.id}),n=this.oldComments.slice(t+1);this.freshComments=this.freshComments.concat(n)}this.oldComments=[]}},e.prototype.addComments=function(e){var t=this;e.forEach(function(e){return t.freshComments.push(e)}),this.organizeComments()},H([d.a],e.prototype,"organizeComments",null),H([d.a],e.prototype,"addComments",null),e}(),G=function(){var e=N({last:10});return e.alias="oldComments",e},D=function(e){return new Promise(function(t,n){E.a.post(function(e){return Object(O.e)([Object(O.b)(e,[(t=N({first:10}),t.alias="freshComments",t),G()])]);var t}(e)).then(function(e){var n=e.issue,o=n.freshComments,a=n.oldComments,r=new M;r.parseGQResponse(o);var s=new M;s.parseGQResponse(a);var c=new A(r,s);t(c)}).catch(n)})},z=n(517),K=n.n(z);function L(e){var t=e.manager,n=e.sectionTop;return 0===t.totalCount?r.a.createElement("p",{className:K.a.noComment},"还没有评论"):r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:K.a.list},t.freshComments.map(function(e){return r.a.createElement(Q,{comment:e,key:e.id,sectionTop:n})})))}function Q(e){var t=e.comment,n=e.sectionTop,o=Object(a.useContext)(c.BlogContext),s=Object(a.useMemo)(function(){return o.author.id===t.author.id?K.a.name+" "+K.a.isAuthor:K.a.name},[t.author.displayName]),i=y.useState("content"),u=i[0],l=i[1];return r.a.createElement("li",{className:K.a.item},r.a.createElement("article",null,r.a.createElement("header",{className:K.a.header},r.a.createElement("div",{className:K.a.headerLeft},r.a.createElement("a",{href:t.author.url,target:"_blank"},r.a.createElement("img",{className:K.a.avatar,src:t.author.avatarUrl}))),r.a.createElement("div",{className:K.a.headerRight},r.a.createElement("p",{className:K.a.row},r.a.createElement("a",{target:"_blank",className:s,href:t.author.url},t.author.displayName)),r.a.createElement("p",{className:[K.a.row,K.a.row1].join(" ")},r.a.createElement("time",{className:K.a.time,dateTime:t.publishedAt},t.timeStr),r.a.createElement("a",{onClick:function(){var e=t.body.split("\r\n").map(function(e){return"> "+e}).join("\r\n");l(""===u?e+"\r\n\r\n":u+"\r\n\r\n"+e+"\r\n\r\n"),window.scrollTo(window.scrollX,n)},className:K.a.reply},"回复")))),r.a.createElement("p",{className:[K.a.body,"markdown-body"].join(" "),dangerouslySetInnerHTML:{__html:t.content}})))}function B(){var e=Object(a.useContext)(c.BlogContext),t=Object(a.useRef)(null),n=Object(a.useState)(null),o=n[0],i=n[1],u=Object(a.useState)(0),l=u[0],m=u[1],f=Object(a.useMemo)(function(){return null!==o},[o]);return Object(a.useEffect)(function(){D(e.number).then(i)},[]),Object(a.useEffect)(function(){if(f){var e=t.current.getBoundingClientRect().top;m(e+window.scrollY)}},[f]),r.a.createElement("section",{className:K.a.container,ref:t},r.a.createElement(j,null),f?r.a.createElement(L,{manager:o,sectionTop:l}):r.a.createElement(s.a,null))}n.d(t,"default",function(){return B})}}]);